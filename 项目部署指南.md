# Medical PDF Extractor 部署指南

## 环境要求

- Ubuntu 20.04+
- Python 3.10+
- CUDA 11.8+
- GPU显存 ≥16GB

## 快速部署

### 1. 启动vLLM服务

```bash
# 16K版本（推荐）
nohup bash /root/autodl-tmp/vllm_server_v13.sh > /root/vllm.log 2>&1 &

# 等待约60秒后验证
curl http://localhost:8000/v1/models
```

### 2. 测试提取

```bash
cd /root/pdf_summarization_deploy_20251225_093847
python3 production_extractor_v79.py /path/to/your.pdf
```

### 3. 批量测试

```bash
python3 test_v79.py /path/to/pdf_dir/ 20
```

## 配置说明

### vLLM参数

| 参数 | 当前值 | 说明 |
|------|--------|------|
| model | Qwen3-8B | 基础模型 |
| dtype | half (fp16) | 精度 |
| max-model-len | 16384 | 上下文长度 |
| gpu-memory-utilization | 0.92 | 显存利用率 |

### 提取器参数

| 参数 | 值 | 说明 |
|------|-----|------|
| MEDIUM_DOC_THRESHOLD | 50 | 中文档阈值 |
| LONG_DOC_THRESHOLD | 80 | 长文档阈值 |
| max_tokens | 6000 | 输出token限制 |

## 故障排查

### vLLM启动失败
```bash
# 检查显存
nvidia-smi

# 查看日志
tail -100 /root/vllm.log
```

### 提取超时
- 检查vLLM服务是否运行
- 减少输入页数
- 增加timeout参数

## 待优化（后续版本）

1. **Milvus语义检索集成**
   - 用向量检索替代关键词选页
   - 需要配置Milvus连接

2. **提示词优化**
   - Quote-then-Structure模式

3. **长文档策略优化**
   - 锚点窗口检索
   - 自适应chunk
